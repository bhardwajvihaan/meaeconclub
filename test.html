<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MEA Economics Club - AP Micro 2.1–2.4 Quiz</title>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: 'DM Sans', sans-serif;
      background-color: #e6f0ec;
      margin: 0;
      padding: 2rem;
      color: #333;
    }
    header {
      text-align: center;
      margin-bottom: 2rem;
    }
    header img {
      max-width: 120px;
    }
    h1 {
      font-size: 1.8rem;
      margin: 0.5rem 0;
    }
    .question {
      background: white;
      padding: 1rem;
      margin-bottom: 1rem;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    button {
      padding: 0.6rem 1.2rem;
      font-size: 1rem;
      border: none;
      border-radius: 6px;
      background-color: #1e5f4f;
      color: white;
      cursor: pointer;
      margin-top: 1rem;
    }
    button:hover {
      background-color: #164c3e;
    }
    .result {
      margin-top: 2rem;
      padding: 1rem;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .correct {
      color: green;
      font-weight: bold;
    }
    .incorrect {
      color: red;
      font-weight: bold;
    }
    input[type="number"] {
      padding: 0.3rem;
      font-size: 1rem;
      width: 100px;
    }
    label {
      display: block;
      margin-bottom: 0.3rem;
    }
  </style>
</head>
<body>
  <header>
    <img src="MEA%20Economics%20Club%20Logo%20(original).png" alt="MEA Logo">
    <h1>AP Microeconomics Quiz: Units 2.1–2.4</h1>
  </header>

  <form id="quizForm">
    <div id="quiz"></div>
    <button type="submit">Submit Quiz</button>
    <div id="result" class="result"></div>
    <button id="downloadPdf" style="display:none;">Download Report as PDF</button>
  </form>

  <script>
    const { jsPDF } = window.jspdf;
    const quizDiv = document.getElementById("quiz");
    const downloadPdfBtn = document.getElementById("downloadPdf");

    const questions = [/* your 25 questions as already included, no changes */];

    questions.forEach((q, i) => {
      const d = document.createElement("div");
      d.className = "question";
      let html = `<p><strong>${i+1}. ${q.q}</strong></p>`;
      if (q.options) {
        q.options.forEach(opt => {
          html += `<label><input type="radio" name="q${i}" value="${opt}" required> ${opt}</label>`;
        });
      } else if (q.type === "number") {
        html += `<input type="number" name="q${i}" step="any" required>`;
      }
      d.innerHTML = html;
      quizDiv.appendChild(d);
    });

    document.getElementById("quizForm").addEventListener("submit", e => {
      e.preventDefault();
      let score = 0;
      const results = [];
      const missedTopics = new Set();

      questions.forEach((q, i) => {
        const ua = document.forms.quizForm[`q${i}`].value;
        const correct = ua.trim().toLowerCase() === q.correct.toString().trim().toLowerCase();
        if (correct) score++;
        else missedTopics.add(q.q.split(" ")[0]); // crude but useful topic marker
        results.push({
          number: i + 1,
          question: q.q,
          selected: ua,
          correctAns: q.correct,
          correct,
          explanation: q.explanation
        });
      });

      const rd = document.getElementById("result");
      rd.innerHTML = `<p><strong>Your score:</strong> ${score} / ${questions.length}</p>`;
      results.forEach(r => {
        rd.innerHTML += `
        <p><strong>Q${r.number}:</strong> ${r.correct ? '<span class="correct">Correct</span>' : '<span class="incorrect">Incorrect</span>'}<br>
        Your answer: <span class="${r.correct ? 'correct' : 'incorrect'}">${r.selected}</span><br>
        Correct answer: <span class="correct">${r.correctAns}</span><br>
        ${!r.correct ? `<em>Explanation:</em> ${r.explanation}` : ''}</p>`;
      });

      downloadPdfBtn.style.display = 'inline-block';

      downloadPdfBtn.onclick = () => {
        const doc = new jsPDF();
        doc.setFont("helvetica");
        doc.setFontSize(14);
        doc.text(`MEA AP Micro 2.1–2.4 Quiz Report`, 10, 15);
        doc.setFontSize(12);
        doc.text(`Score: ${score} / ${questions.length}`, 10, 25);

        if (missedTopics.size > 0) {
          doc.setTextColor(200, 0, 0);
          doc.text("Recommended Areas to Review:", 10, 35);
          let y = 42;
          missedTopics.forEach(topic => {
            doc.text(`- ${topic}`, 12, y);
            y += 7;
          });
          doc.setTextColor(0, 0, 0);
        }

        let y = 60;
        results.forEach(r => {
          if (y > 270) { doc.addPage(); y = 20; }
          doc.setFontSize(12);
          doc.setTextColor(0, 0, 0);
          doc.text(`${r.number}. ${r.question}`, 10, y); y += 7;
          if (!r.correct) {
            doc.setTextColor(255, 0, 0);
            doc.text(`Your answer: ${r.selected}`, 10, y); y += 7;
            doc.setTextColor(0, 128, 0);
            doc.text(`Correct answer: ${r.correctAns}`, 10, y); y += 7;
            doc.setTextColor(0, 0, 0);
            doc.text(`Explanation: ${r.explanation}`, 10, y); y += 10;
          } else {
            doc.setTextColor(0, 128, 0);
            doc.text(`Correct`, 10, y); y += 10;
          }
        });

        doc.save("AP_Micro_Quiz_Report.pdf");
      };
    });
  </script>
</body>
</html>
